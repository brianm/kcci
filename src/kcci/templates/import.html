{% extends "base.html" %}

{% block title %}Import - KCCI{% endblock %}

{% block content %}
<h2>Import Your Kindle Library</h2>

<div class="instructions">
    <h3>How to get your Kindle library webarchive:</h3>
    <ol>
        <li>Open Safari and go to <a href="https://read.amazon.com" target="_blank">read.amazon.com</a></li>
        <li>Sign in with your Amazon account</li>
        <li>Wait for your library to fully load (scroll down to load all books)</li>
        <li>From the menu bar, choose <strong>File &rarr; Save As...</strong></li>
        <li>Set Format to <strong>"Web Archive"</strong></li>
        <li>Save the file, then select it below</li>
    </ol>
</div>

<label class="import-zone" id="importZone" for="fileInput">
    <div class="import-zone-icon">ðŸ“š</div>
    <div class="import-zone-text">
        Click to select your webarchive file
    </div>
    <input type="file" id="fileInput">
</label>

<div class="stats-info">
    <p>Current library: <strong>{{ stats.total_books }}</strong> books, <strong>{{ stats.with_embeddings }}</strong> with embeddings</p>
</div>

<script>
(function() {
    const fileInput = document.getElementById('fileInput');

    fileInput.addEventListener('change', function(e) {
        console.log('File input changed:', e.target.files);
        const file = e.target.files[0];
        if (!file) return;

        console.log('File selected:', file.name);
        if (!file.name.endsWith('.webarchive')) {
            alert('Please select a .webarchive file');
            return;
        }
        window.startSync(file);
    });

    console.log('Import page initialized');
})();
</script>
{% endblock %}
